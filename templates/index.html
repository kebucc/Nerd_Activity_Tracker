{% extends "base.html" %}

{% block script_config %}
<script>
    window.DASH_CONFIG = {
        viewMode: "{{ view_mode }}",
        dateStr: "{{ date_str }}",
        startDate: "{{ start_date }}",
        endDate: "{{ end_date }}"
    };
</script>
{% endblock %}

{% block content %}
<section class="date-nav">
    <button id="nav-prev" title="Previous {{ view_mode }}">&larr;</button>
    <span id="current-date" data-date="{{ date_str }}">{{ nav_label }}</span>
    <button id="nav-next" title="Next {{ view_mode }}">&rarr;</button>
</section>

<!-- View Mode Tabs -->
<section class="view-tabs">
    <a href="/day/{{ date_str }}" class="view-tab {% if view_mode == 'day' %}active{% endif %}">Day</a>
    <a href="/week/{{ date_str }}" class="view-tab {% if view_mode == 'week' %}active{% endif %}">Week</a>
    <a href="/month/{{ date_str }}" class="view-tab {% if view_mode == 'month' %}active{% endif %}">Month</a>
</section>

<!-- Stats Cards Row -->
<section class="stats-row">
    <div class="stat-card">
        <h2 class="card-title cumulative-color">Cumulative</h2>
        <div class="stat-item">
            <span class="stat-label">Total Time</span>
            <span class="stat-value cumulative-color">{{ cumulative_summary.total_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Average Duration</span>
            <span class="stat-value cumulative-color">{{ cumulative_summary.avg_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Sessions</span>
            <span class="stat-value cumulative-color">{{ cumulative_summary.session_count }}</span>
        </div>
    </div>
    <div class="stat-card">
        <h2 class="card-title mouse-color">Mouse</h2>
        <div class="stat-item">
            <span class="stat-label">Total Time</span>
            <span class="stat-value mouse-color">{{ mouse_summary.total_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Average Duration</span>
            <span class="stat-value mouse-color">{{ mouse_summary.avg_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Sessions</span>
            <span class="stat-value mouse-color">{{ mouse_summary.session_count }}</span>
        </div>
    </div>
    <div class="stat-card">
        <h2 class="card-title keyboard-color">Keyboard</h2>
        <div class="stat-item">
            <span class="stat-label">Total Time</span>
            <span class="stat-value keyboard-color">{{ keyboard_summary.total_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Average Duration</span>
            <span class="stat-value keyboard-color">{{ keyboard_summary.avg_duration_formatted }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Sessions</span>
            <span class="stat-value keyboard-color">{{ keyboard_summary.session_count }}</span>
        </div>
    </div>
</section>

<!-- Timelines -->
<section class="timelines">
    {% if view_mode == 'day' %}
    <div class="timeline-hours">
        {% for h in range(25) %}
        <span>{{ "%02d"|format(h) if h < 24 else "" }}</span>
        {% endfor %}
    </div>
    <div id="timeline-cumulative" class="timeline-bar"></div>
    <div id="timeline-mouse" class="timeline-bar"></div>
    <div id="timeline-keyboard" class="timeline-bar"></div>

    {% elif view_mode == 'week' %}
    <div class="week-chart" id="week-chart"
         data-start="{{ start_date }}" data-end="{{ end_date }}">
    </div>

    {% elif view_mode == 'month' %}
    <div class="month-chart" id="month-chart"
         data-start="{{ start_date }}" data-end="{{ end_date }}">
    </div>
    {% endif %}
</section>

<!-- Session Detail -->
<section class="session-list">
    <h2>Session Detail</h2>
    <table id="sessions-table">
        <thead>
            <tr>
                <th>#</th>
                {% if view_mode != 'day' %}<th>Date</th>{% endif %}
                <th>Type</th>
                <th>Start</th>
                <th>End</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <p id="no-sessions" class="hidden">No sessions recorded for this period.</p>
</section>
{% endblock %}
